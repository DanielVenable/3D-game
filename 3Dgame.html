<html><head><title>3D game</title>
<script src="https://code.jquery.com/jquery-3.1.0.slim.min.js" 
integrity="sha256-cRpWjoSOw5KcyIOaZNo4i6fZ9tKPhYYb6i5T9RSVJG8=" 
crossorigin="anonymous"></script><style>
div {
	position: absolute;
}
img {
	position: absolute;
	width: 20px;
	height: 20px;
}
</style></head><body>
<span id="world"></span></body><script>
var objects = [],
	speed = 0.2,
	level = 0;
next_level();
fall();
function next_level() {
	level++;
	objects.length = 0;
	$('#world').empty();
	new_obj('cube side',0,0,-500, 1000,1000,10, 'black');//back
	new_obj('cube side',0,0,500, 1000,1000,10, 'black');//front
	new_obj('cube side',-500,0,0, 10,1000,1000, 'black');//left
	new_obj('cube side',500,0,0, 10,1000,1000, 'black');//right
	new_obj('cube side',0,500,0, 1000,10,1000, 'black');//top
	new_obj('cube side',0,-500,0, 1000,10,1000, 'black');//bottom
	switch (level) { // greater z means closer
		case 1:
			//new_obj('ball', 100,200,300, 20,20,20);
		break;
	}
	draw_cube();
}
function draw_cube() {
	$('#world').empty();
	objects.forEach(function(e) {
		if (e.type == 'ball') {
			$('#world').append(
			'<img src="ball.png" style="top:'+(530-e.y)+'; left:'+(510+e.x)+
			';z-index:'+(e.z+10)+'"/>');
		} else if (e.type != 'cube side' || e.depth == 1000/*not show front or back*/) {
   			$('#world').append('<div style="background-color:'+e.color+';top:'+
			(520-e.y-e.height/2)+';left:'+(520+e.x-e.width/2)+';width:'+e.width+
			';height:'+e.height+';z-index:'+(e.z+e.depth/2)+'"></div>');
		}
	});
}

function view_right() { 
	objects.forEach(function(e) {
		e.New_z = -e.x;
		e.x = e.z;
		e.z = e.New_z;
		e.New_depth = e.width;
		e.width = e.depth;
		e.depth = e.New_depth;
	});
	draw_cube();
}
function view_left() { 
	objects.forEach(function(e) {
		e.New_z = e.x;
		e.x = -e.z;
		e.z = e.New_z;
		e.New_depth = e.width;
		e.width = e.depth;
		e.depth = e.New_depth;
	});
	draw_cube();
}

function tilt_clockwise() {
	objects.forEach(function(e) {
		e.New_y = -e.x;
		e.x = e.y;
		e.y = e.New_y;
		e.New_height = e.width;
		e.width = e.height;
		e.height = e.New_height;
	});
	draw_cube();
}

function tilt_counter_clockwise() {
	objects.forEach(function(e) {
		e.New_y = e.x;
		e.x = -e.y;
		e.y = e.New_y;
		e.New_height = e.width;
		e.width = e.height;
		e.height = e.New_height;
	});
	draw_cube();
}

function new_obj(objtype, objx, objy, objz, objwidth, objheight, objdepth, objcolor) {
	objects.push({  x:objx, y:objy, z:objz,width:objwidth, height:objheight,
					depth:objdepth, type:objtype, color:objcolor});
}

function overlap1d(x1, width1, x2, width2) {
	return (
		(x1 <= x2 && x2 <= x1 + width1)||
		(x2 <= x1 && x1 <= x2 + width2));
}

function overlap(object1, object2) {
	var xol = overlap1d(object1.x-object1.width/2, object1.width,
						object2.x-object2.width/2, object2.width),
		yol = overlap1d(object1.y-object1.height*2 - 2, object1.height,
						object2.y-object2.height*2 + 2, object2.height),
		zol = overlap1d(object1.z-object1.depth/2, object1.depth,
						object2.z-object2.depth/2, object2.depth);
	return (xol && yol && zol);
}

function fall() {
	speed += 0.2;
	for (i = 0; i < objects.length; i++) {
		if (objects[i].type == 'ball' || objects[i].type == 'movable') {
			objects[i].y = objects[i].y - speed;
			for (j = 0; j < objects.length; j++) {
				if (overlap(objects[i], objects[j]) && i != j) {
					while (overlap(objects[i], objects[j])) {
						objects[i].y += 0.2;
					}
					speed = 0.2;
					break;
				}
			}
			draw_cube();
		}
	}
	setTimeout(fall, 0); //keep falling
}

$(document).keydown(function(e) {
	switch(e.which) {
		case 37: tilt_counter_clockwise(); break;
		case 39: tilt_clockwise(); break;
		case 65: view_left(); break;
		case 68: view_right(); break;
	}
});

</script></html>