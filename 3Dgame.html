<html><head><title>3D game</title>
<script src="https://code.jquery.com/jquery-3.1.0.slim.min.js" 
integrity="sha256-cRpWjoSOw5KcyIOaZNo4i6fZ9tKPhYYb6i5T9RSVJG8=" 
crossorigin="anonymous"></script><style>
div {
	position: absolute;
}
img {
	position: absolute;
	width: 20px;
	height: 20px;
}
canvas {
	border: 10px solid #000000;
}
</style></head><body>
<canvas id="world" height="1000", width="1000">Your browser does not support the canvas element.
Please use another browser</canvas></body><script>
var objects = [],
	is_falling = false,
	canvas = $("canvas")[0].getContext("2d"),
	eyes = {x:0, y:0, z:1000},
	level = 0;
next_level();
fall();
function next_level() {
	level++;
	objects = [];
	$('#world').empty();
	new_obj('cube side',0,0,-500, 1000,1000,10, 'black');//back
	new_obj('cube side',0,0,500, 1000,1000,10, 'black');//front
	new_obj('cube side',-500,0,0, 10,1000,1000, 'black');//left
	new_obj('cube side',500,0,0, 10,1000,1000, 'black');//right
	new_obj('cube side',0,500,0, 1000,10,1000, 'black');//top
	new_obj('cube side',0,-500,0, 1000,10,1000, 'black');//bottom
	switch (level) { // greater z means closer
		case 1:
			new_obj('ball', -450,450,0, 20,20,20);
			new_obj('exit', 450,450,0, 100,100,100);
		break;
		case 2:
			new_obj('ball', -50,350,0, 20,20,20);
			new_obj('exit', 50,50,0, 100,100,100);
			new_obj('wall', 0,-200,0, 10,600,200, 'rgb(100,100,100)');
		break;
		case 3:
			new_obj('ball', -50,450,0, 20,20,20);
			new_obj('exit', -60,-450,0, 100,100,100);
			new_obj('wall', -50,0,0, 900,10,0, 'rgb(200,200,200)');
			new_obj('wall', 0,-350,0, 10,300,0, 'rgb(100,100,100)');
		break;
		case 4:
			new_obj('ball', 350,50,0, 20,20,20);
			new_obj('exit', -150,-250,0, 100,100,100);
			new_obj('wall', -250,0,0, 500,10,0, 'rgb(200,200,200)');
			new_obj('wall', 300,0,0, 400,10,0, 'rgb(200,200,200)');
			new_obj('wall', 100,450,0, 10,100,0, 'rgb(100,100,100)');
			new_obj('wall', -200,-450,0, 10,100,0, 'rgb(100,100,100)');
		break;
		case 5:
			new_obj('ball', -350,150,0, 20,20,20);
			new_obj('exit', 350,150,0, 100,100,100);
			new_obj('wall', 0,300,0, 1000,10,0, 'rgb(200,200,200)');
			new_obj('wall', 0,-300,0, 1000,10,0, 'rgb(200,200,200)');
			new_obj('wall', 50,0,0, 10,300,0, 'rgb(100,100,100)');
			new_obj('wall', -50,0,0, 10,400,0, 'rgb(150,150,150)');
			new_obj('movable', 0,0,0, 88,200,0, 'rgb(50,50,255)');
		break;
	}
	for (i = 0; i < objects.length; i++) {
		if (objects[i].type == 'ball' || objects[i].type == 'movable') {
			objects[i].speed = 0.2;
		}
	}
	draw_cube();
}
function draw_cube() {
	canvas.clearRect(0,0,1000,1000);
	for (x = 0; x < 1000; x++) {
		for (y = 0; y < 1000; y++) {
			if (is_pixel_active(x,y)) {
				canvas.fillRect(x,y,1,1)
			}
		}
	}
}

function is_pixel_active() {

}

function view_right() { 
	objects.forEach(function(e) {
		e.New_z = -e.x;
		e.x = e.z;
		e.z = e.New_z;
		e.New_depth = e.width;
		e.width = e.depth;
		e.depth = e.New_depth;
	});
	draw_cube();
}
function view_left() { 
	objects.forEach(function(e) {
		e.New_z = e.x;
		e.x = -e.z;
		e.z = e.New_z;
		e.New_depth = e.width;
		e.width = e.depth;
		e.depth = e.New_depth;
	});
	draw_cube();
}
function tilt_clockwise() {
	if (!is_falling) {
		objects.forEach(function(e) {
			e.New_y = -e.x;
			e.x = e.y;
			e.y = e.New_y;
			e.New_height = e.width;
			e.width = e.height;
			e.height = e.New_height;
		});
		draw_cube();
	}
}
function tilt_counter_clockwise() {
	if (!is_falling) {
		objects.forEach(function(e) {
			e.New_y = e.x;
			e.x = -e.y;
			e.y = e.New_y;
			e.New_height = e.width;
			e.width = e.height;
			e.height = e.New_height;
		});
		draw_cube();
	}
}
function new_obj(objtype, objx, objy, objz, objwidth, objheight, objdepth, objcolor) {
	objects.push({  x:objx, y:objy, z:objz, width:objwidth, height:objheight,
					depth:objdepth, type:objtype, color:objcolor});
}
function overlap1d(x1, width1, x2, width2) {
	return (
		(x1 <= x2 && x2 - width2/2 <= x1 + width1/2)||
		(x2 <= x1 && x1 - width1/2 <= x2 + width2/2));
}
function overlap(object1, object2) {
	var xol = overlap1d(object1.x, object1.width, object2.x, object2.width),
		yol = overlap1d(object1.y, object1.height, object2.y, object2.height),
		zol = overlap1d(object1.z, object1.depth, object2.z, object2.depth);
	return (xol && yol && zol);
}
function fall() {
	var not_falling_number = 0;
	var total_number = 0;
	for (i = 0; i < objects.length; i++) {
		if (objects[i].type == 'ball' || objects[i].type == 'movable') {
			objects[i].speed += 0.2;
			objects[i].y -= objects[i].speed;
			total_number++;
			for (j = 0; j < objects.length; j++) {
				if (overlap(objects[i], objects[j]) && i != j) {
					not_falling_number++;
					while (overlap(objects[i], objects[j])) {
						objects[i].y += 0.2;
					}
					objects[i].speed = 0.2;
					if (objects[j].type == 'exit' && objects[i].type == 'ball') {
						next_level();
					}
					break;
				}
			}
			draw_cube();
		}
	}
	is_falling = (not_falling_number != total_number);
	setTimeout(fall, 0); //keep falling
}
$(document).keydown(function(e) {
	switch(e.which) {
		case 37: tilt_counter_clockwise(); break;
		case 39: tilt_clockwise(); break;
		case 65: view_left(); break;
		case 68: view_right(); break;
	}
});
</script></html>
